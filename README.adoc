= Design Patterns - TD
J.-M. Bruel <jbruel@gmail.com>
v20.1 {localdate}
:tdnum: TD3
:uk:
:imagesdir: images
//------------------------- variables de configuration
// only used when master document
:icons: font
:experimental:
:numbered!:
:status:
:source-highlighter: rouge
:baseURL: http://bit.ly/innopolis-patterns
:github: https://github.com[GitHub]
// Specific to GitHub
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:

endif::[]
//------------------------------------ 
ifdef::uk[]
:lang: uk
:lastName: LAST NAME
:firstName: First Name
:group: Group
:example: Example
:Enseignants: Teachers
:principe: Good design principle
:assignment: Assignment info
:requirements: Requirements
:initial: Initial tasks
:allerPlusLoin: Still hungry?...
:about: About...
:contrib: Contributors
:translation: Translations
endif::[]
ifndef::uk[]
:lang: fr
:lastName: NOM
:firstName: Prénom
:group: Groupe
:example: Exemple
:Enseignants: Enseignants
:principe: Principe Objet
:assignment: Informations générales
:requirements: Pré-requis
:initial: Tâche initiale
:allerPlusLoin: Pour Aller plus loin...
:about: À propos...
:contrib: Contributeurs
:translation: Traductions
endif::[]
:java: https://www.java.com/fr/[Java]
:asciidoc: http://www.methods.co.nz/asciidoc[AsciiDoc]indexterm:[AsciiDoc]
:asciidoctorlink: http://asciidoctor.org/[Asciidoctor]indexterm:[Asciidoctor]
//------------------------------------ 

ifdef::uk[]
== {tdnum} initial code
This is a template for the students' assignments.

ifndef::backend-pdf[]
TIP: Course material: pass:[<i class="fa fa-mobile"></i> <i class="fa fa-tablet"></i> <i class="fa fa-laptop"></i>] {baseURL}
endif::[]

ifdef::backend-pdf[]
TIP: Course material: icon:mobile[] icon:tablet[] icon:laptop[] {baseURL}
endif::[]
endif::[]

ifndef::uk[]
== Code initial pour le {tdnum}

ifndef::backend-pdf[]
TIP: Rappel du cours : pass:[<i class="fa fa-mobile"></i> <i class="fa fa-tablet"></i> <i class="fa fa-laptop"></i>] {baseURL}
endif::[]

ifdef::backend-pdf[]
TIP: Rappel du cours : icon::mobile[] icon::tablet[] icon::[]laptop {baseURL}
endif::[]

endif::[]

//------------------------------------ 
== {assignment}

{lastName}:: BRUEL

{firstName}:: Jean-Michel

{group} #::

[%interactive]
- [x] {Enseignants}
- [ ] 1
- [ ] 2
- [ ] 3
- [ ] 4
- [ ] Innopolis

//------------------------------------ 
== {requirements}

ifdef::uk[]
You'll need:

[%interactive]
* [x] A {Github} account  
* [ ] A https://gitforwindows.org/[Git Bash] terminal (if you use Window$)
endif::[]
ifndef::uk[]
Il vous faut :

[%interactive]
* [x] Un compte {Github}  
* [ ] Un terminal de type https://gitforwindows.org/[Git Bash]  (si vous utilisez Window$)
endif::[]

ifdef::uk[]
[TIP]
====    
Try the following command in your terminal to check your `git` environment:
endif::[]
ifndef::uk[]
[TIP]
====    
Essayez la commande suivante dans votre terminal pour vérifier votre environnement `git` :
endif::[]

[source,shell]
....
git config --global -l
....
====

//------------------------------------ 
== {initial}

ifdef::uk[]
[%interactive]
* [x] Click on the Github Classroom link proided by your teacher (in fact, this should be done if you read this).
* [ ] Clone on your machine the Github project generated by Github Classroom.  
* [ ] Modify the README file to add your last name, first name and group number. 
* [ ] Commit and push using the following message:
endif::[]
ifndef::uk[]
[%interactive]
* [x] Clickez sur le lien Github Classroom fourni par votre enseignant (en fait c'est déjà fait si vous lisez ces lignes).
* [ ] Clonez sur votre machine le projet Github généré pour vous par Github Classroom.  
* [ ] Modifez le `README` pour modifier Nom, Prénom et Groupe. 
* [ ] Commit & push:
endif::[]

ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #0 Initial task done
....

[IMPORTANT]
ifndef::uk[]
Dans la suite de ce document, à chaque fois que vous trouverez un énoncé commençant par `fix #...` vous devez vérifier que vos scripts/fichiers modifiés sont bien dans votre dépôt local en vue de committer et de pusher les modifications sur votre dépôt distant en utilisant comme message de commit cet énoncé.

[TIP]
====
- Si vous voulez vérifier que vous êtes prêt pour le `fix #0`, utilisez la commande : `make check`.
- Si vous voulez avoir la liste des ToDos de ce TP/TP, exécutez `make todos`.
====
endif::[]
ifdef::uk[]
In the following, every time you'll see à `fix #...` text, 
make sure all your files are committed, and then push your modifications in the distant repo, making sure you used the corresponding message (`fix #...`) in one of the `commit` messages.

[TIP]
====
- If you want to check that you're really ready for `fix #0`, you can run the command in your shell: `make check`.
- If you want to list the ToDos of the day, run `make todos`.
====
endif::[]

[NOTE]
=====
This TD exercise is inspired from the excellent https://www.oreilly.com/library/view/head-first-design/0596007124/[book]: "Head First: Design Pattern.
Bert Bates, Eric Freeman, Elisabeth Freeman, Kathy Sierra. Editions O'Reilly. 2005."

image::headFirst.jpg[link="https://www.oreilly.com/library/view/head-first-design/0596007124/",width=40%,scaledwidth=20%, align=center]
=====

//------------------------------------ 
//------------------------------------ 
//------------------------------------ 
//------------  Let's START----------- 
//------------------------------------ 
//------------------------------------ 

:numbered:
//------------------------------------ 
== The O'Reilly pizzeria

=== Existing application

You are hired in a pizzeria to do ... computer science!
Last year's intern who worked on the code left. 
You only have at your disposal:

- The following starting code:
+
.`Pizzeria.java` initial code (source available in your `src`)
[source,java]
------
include::src/main/java/Pizzeria.java[]
------
+
- The following pizza class diagram draft:
+
image::Pizzas.svg[width=70%, scaledwidth=70%, align=center]
+
- The following piece of test code:
+
[source, java]
------
Pizzeria boutiqueBrest = new Pizzeria ();
boutiqueBrest.commanderPizza ("cheese");
...
Pizzeria boutiqueStrasbourg = new Pizzeria ();
boutiqueStrasbourg.commanderPizza ("Greek");
------

// ----------------------------- Question ------------------
.*TODO*:
[WARNING]
====
[%interactive]
* [ ] Identify what varies in this code (if market pressure makes
add pizzas to the menu or if a pizza is no longer successful and must disappear, etc.).
* [ ]  Isolate this code in a `SimpleFabriqueDePizzas` class.
+
[TIP]
=====
- The idea is to replace the `if` in that code by something like `pizza = fabrique.creerPizza(type);`
- You have inherited from this horrible "if then else". In your implementation, you might want to use a `switch case` and may be an `enum`.
=====
+
* [ ]  Provide the resulting class diagram.
* [ ]  What is the advantage of doing this? Don't we transfer
just the problem to another object?
+
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.1 Simple Pizza Factory
....
+
====


== Almost there...

=== Success of the O'Reilly pizzerias: Franchising the pizza stores

Several cities want to open pizzerias like yours.
Your boss, very happy with your programs wants to impose on all
future pizzerias to use your codes.

The problem: Strasbourg cheese pizzas are different
pizzas with Corsican cheeses!

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
Propose a solution where `SimpleFabriqueDePizzas` would be an abstract
class.
====

ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #2.1 Use of abstract factories
....

We have end-up with a clean code that is almost a pattern. 
Often called _Simple Factory_, it is nevertheless not considered as a Design Pattern:

[NOTE]
.Design pattern : *Simple Factory*
====
include::pattern/factory.txt[]
====

=== Problem: everyone works as they see fit!

Pizzerias use your factories well but have changed their procedures: some do not cut the pizzas, change the
cooking times, and O'Reilly pizzerias lose their identity. 
So we need to *restructure* the pizzerias.

A highly paid Italian consultant (fortunately in pizzas!)
proposes to return to the following structure:

[source,java]
------
public abstract class Pizzeria {
	public final Pizza commanderPizza(String type) {
		Pizza pizza;

		pizza = creerPizza(type);
		pizza.preparer();
		pizza.cuire();
		pizza.couper();
		pizza.emballer();

		return pizza;
	}

	....... Pizza creerPizza(String type);
}
------

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
What are the differences with our current design?
====

=== Allowing the subclasses to decide

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
In the following diagram, place the methods in the right place
so that the procedures are followed while having pizza
with "regional" variants.

image::Pizzeria3.svg[width=60%,scaledwidth=60%]
====

.*TIP*
TIP: Each subclass redefines the `creerPizza ()` method,
while all the subclasses use the `commanderPizza ()` method
defined in `Pizzeria`.


ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #2.3 Simple Pizza Factory
....


=== Declaring a factory method

Just by bringing one or two transformations to `Pizzeria`,
we have gone from an object managing the instantiation of our concrete classes
to a set of subclasses that now assume this responsibility.

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
What is the exact declaration of the `creerPizza()` method of
the `Pizzeria` class ?
====

=== So, how does it work ?

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
Give a sequence diagram of a "order a cheese pizza
of Strasbourg type".
====

NOTE: You will implement the missing class in TP.

ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #2.5 Simple Pizza Factory
....

== The Abstract Factory pattern

Here we are! We have, in fact, used the Factory pattern:

[NOTE]
.Design pattern : *Factory (simple)*
====
include::pattern/factory-abstract.txt[]
====

ifndef::compact[]

.Several examples of Factory pattern definitions
image::google-fabrique.png[link="images/google-fabrique.png",width=100%,scaledwidth=100%]

//------------------------------------ 
== {translation}
//------------------------------------ 

.Translations French/English/Russian of the code vocabulary
[options="header,footer"]
|===============================================
| FR 					|  US     			| RU
| Grecque     			|  Greek       		| ??
| Fromage       		|  Cheese   		| ??
| Poivron     			|  Pepper   		| ??
| preparer     			|  prepare   		| ??
| cuire     			|  bake        		| ??
| couper     			|  cut         		| ??
| emballer     			|  wrap        		| ??
| creer      			|  create   		| ??
| commander    			|  order       		| ??
|===============================================

//------------------------------------ 
== {contrib}
//------------------------------------ 

- mailto:jbruel@gmail.com[Jean-Michel Bruel]

== {about}

****************************************************************
Baked with {asciidoctorlink} (version `{asciidoctor-version}`) from 'Dan Allen', based on {asciidoc}.
'Licence Creative Commons'.
image:88x31.png["Licence Creative
Commons",style="border-width:0",link="http://creativecommons.org/licenses/by-sa/3.0/"]
http://creativecommons.org/licenses/by-sa/3.0/[licence Creative Commons Paternité - Partage à l&#39;Identique 3.0 non transposé].
****************************************************************
endif::compact[]
